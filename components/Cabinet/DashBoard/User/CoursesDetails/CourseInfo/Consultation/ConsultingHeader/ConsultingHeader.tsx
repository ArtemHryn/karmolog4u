'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useSuspenseQuery } from '@tanstack/react-query';
import { ToastContainer } from 'react-toastify';
import AgreementInfo from './AgreementInfo/AgreementInfo';
import Greeting from './Greeting/Greeting';
import AboutCourse from './AboutCourse/AboutCourse';
import { fetchCourseDetailsForUser } from '@/helper/platform/fetchCourseDetailsForUser';
import { ADVANCED, CONSULTING } from '@/helper/consts';

import styles from './ConsultingHeader.module.scss';
import 'react-toastify/dist/ReactToastify.css';

type courseType = typeof CONSULTING | typeof ADVANCED;

interface ConsultingHeaderProps {
  token: string;
  id: string;
}

const defaultTitle = '–õ—é–±—ñ –¥—Ä—É–∑—ñ!';
const agreementTitle = '–í—ñ—Ç–∞—î–º–æ –≤–∞—Å! üåø';
const literalTitle = '–ù–∞–≤—á–∞–ª—å–Ω–∞ —Ç–∞ —Ä–æ–∑–≤–∏—Ç–∫–æ–≤–∞ –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞';

const defaultText: Record<courseType, string[]> = {
  [CONSULTING]: [
    '–í—ñ—Ç–∞—î–º–æ –≤–∞—Å –Ω–∞ –ø–æ—á–∞—Ç–∫—É –∑–∞—Ö–æ–ø–ª–∏–≤–æ–≥–æ —à–ª—è—Ö—É –¥–æ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç—É–≤–∞–Ω–Ω—è! –í–∏ –∑—Ä–æ–±–∏–ª–∏ –≤–∞–∂–ª–∏–≤–∏–π –∫—Ä–æ–∫ –Ω–µ –ª–∏—à–µ –¥–ª—è —Å–µ–±–µ, –∞ –π –¥–ª—è —Ç–∏—Ö, –∫–æ–º—É –∑–º–æ–∂–µ—Ç–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É. –ü–æ–ø–µ—Ä–µ–¥—É ‚Äì –≥–ª–∏–±–æ–∫–µ –Ω–∞–≤—á–∞–Ω–Ω—è, —Å–∞–º–æ–ø—ñ–∑–Ω–∞–Ω–Ω—è —Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è, —â–æ –≤—ñ–¥–∫—Ä–∏—î –Ω–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ —Ç–∞–ª–∞–Ω—Ç–∏.',
    '–ù–µ—Ö–∞–π —Ü–µ–π –∫—É—Ä—Å —Å—Ç–∞–Ω–µ –¥–ª—è –≤–∞—Å –¥–∂–µ—Ä–µ–ª–æ–º –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è, —É—Å–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è. –í–∏ –Ω–µ —Å–∞–º—ñ ‚Äì –ø–æ—Ä—É—á —Å–ø—ñ–ª—å–Ω–æ—Ç–∞ –æ–¥–Ω–æ–¥—É–º—Ü—ñ–≤ —ñ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏, –≥–æ—Ç–æ–≤—ñ –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—Å —É —Ü—å–æ–º—É –ø—Ä–æ—Ü–µ—Å—ñ. –î–æ–≤—ñ—Ä—è–π—Ç–µ —Å–æ–±—ñ, –±—É–¥—å—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –¥–æ –Ω–æ–≤–∏—Ö –∑–Ω–∞–Ω—å —ñ –Ω–µ –±—ñ–π—Ç–µ—Å—è –∑–º—ñ–Ω, –∞–¥–∂–µ —Å–∞–º–µ –≤–æ–Ω–∏ –ø—Ä–∏–≤–µ–¥—É—Ç—å –≤–∞—Å –¥–æ –≤–∞—à–æ–≥–æ —ñ—Å—Ç–∏–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è.',
    '–ë–∞–∂–∞—î–º–æ –≤–∞–º –ª–µ–≥–∫–æ—Å—Ç—ñ –≤ –Ω–∞–≤—á–∞–Ω–Ω—ñ, –≥–ª–∏–±–æ–∫–∏—Ö –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ–≤ —ñ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –≤ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ!',
  ],
  [ADVANCED]: [
    '–†–∞–¥–∏–π –∑–Ω–æ–≤—É –∑—É—Å—Ç—Ä—ñ—Ç–∏—Å—è –∑ –≤–∞–º–∏, –º–æ—ó –≥–µ–Ω—ñ–∞–ª—å–Ω—ñ –£—á–Ω—ñ!',
    '–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –Ω–∞ –∫—É—Ä—Å –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–æ–≤–æ—ó –≥–ª–∏–±–∏–Ω–∏ —Ç–∞ —Ä—ñ–≤–Ω—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –ù–∞ –≤–∞—Å —á–µ–∫–∞—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∞–≤—Ç–æ—Ä—Å—å–∫—ñ —Ç—Ä–µ–Ω—ñ–Ω–≥–∏ –ø—Ä–æ –Ω–µ–≤–∏–¥–∏–º—ñ –≥—Ä–∞–Ω—ñ –ú–∞—Ç—Ä–∏—Ü—ñ, —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ —Ä–æ–±–æ—Ç–∏, —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –±–∞–≥–∞—Ç–æ—Ä—ñ—á–Ω–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É –º–æ—î—ó –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—ó –ø—Ä–∞–∫—Ç–∏–∫–∏, –∞ —Ç–∞–∫–æ–∂ –±–µ–∑–ª—ñ—á –¥–∏–≤–æ–≤–∏–∂–Ω–∏—Ö –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ–≤ –ø—Ä–æ –ú–∞—Ç—Ä–∏—Ü—é.',
    '–ù–∞ —Ü—å–æ–º—É –∫—É—Ä—Å—ñ —è –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É –∑ –≤–∞–º–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —è–∫ –∑ –£—á–Ω—è–º–∏, –∞ —è–∫ –∑ –ú–∞–π—Å—Ç—Ä–∞–º–∏ –∫–∞—Ä–º–æ—Ç–µ—Ä–∞–ø—ñ—ó.',
    '–°–ø–æ–¥—ñ–≤–∞—é—Å—è, –≤–∏ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –¥–æ –Ω–æ–≤–∏—Ö –∑–Ω–∞–Ω—å —ñ –≥–æ—Ç–æ–≤—ñ –ø—ñ–∑–Ω–∞—Ç–∏ –Ω–µ–≤—ñ–¥–æ–º—ñ –≥—Ä–∞–Ω—ñ –ö—Ä–∏—Å—Ç–∞–ª–∞ –≤–∞—à–æ—ó –î—É—à—ñ!',
  ],
};
const agreementText = [
  '–ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –Ω–∞–≤—á–∞–Ω–Ω—è –ø—Ä–æ—Å–∏–º–æ –≤–∞—Å –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –¥–æ–≥–æ–≤–æ—Ä–æ–º, –≤ —è–∫–æ–º—É –∑—ñ–±—Ä–∞–Ω—ñ –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏: —è–∫ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –∑–∞–Ω—è—Ç—Ç—è, —è–∫ –≤–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –æ–ø–ª–∞—Ç–∞, –∑–∞—Ö–∏—Å—Ç –∞–≤—Ç–æ—Ä—Å—å–∫–∏—Ö –ø—Ä–∞–≤ —Ç–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å.',
  '–¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞–ª—å–Ω—ñ—Å—Ç—å ‚Äî —Ü–µ –Ω–∞—à —ñ–∑ –≤–∞–º–∏ ¬´–∫–æ–¥ –¥–æ–≤—ñ—Ä–∏¬ª, —è–∫–∏–π –¥–æ–ø–æ–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∏–π, –ø—Ä–æ–∑–æ—Ä–∏–π —Ç–∞ –±–µ–∑–ø–µ—á–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É.',
  '–ë—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–∏–¥—ñ–ª—ñ—Ç—å –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω, —â–æ–± –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–æ–≥–æ–≤—ñ—Ä. –Ø–∫—â–æ –≤—Å–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ —ñ –≤–∞—Å –≤—Å–µ –≤–ª–∞—à—Ç–æ–≤—É—î –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å —Å–≤–æ—é –∑–≥–æ–¥—É.',
  "–Ø–∫—â–æ –≤–∏–Ω–∏–∫–Ω—É—Ç—å –ø–∏—Ç–∞–Ω–Ω—è - –Ω–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è, –º–∏ –∑–∞–≤–∂–¥–∏ –Ω–∞ –∑–≤'—è–∑–∫—É üí¨ —ñ –Ω–µ—Ö–∞–π —Ü–µ–π –∫—É—Ä—Å —Å—Ç–∞–Ω–µ –¥–ª—è –≤–∞—Å –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è–º, –æ–ø–æ—Ä–æ—é —Ç–∞ –∫—Ä–æ–∫–æ–º –¥–æ —Å–µ–±–µ —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ.",
];
const literalText = [
  '–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –∑—ñ–±—Ä–∞–Ω–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –ø—ñ–¥—ñ–±—Ä–∞–Ω—É –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä—É, —è–∫–∞ —Å—Ç–∞–Ω–µ –≤–∞—à–∏–º –Ω–∞–¥—ñ–π–Ω–∏–º —Å—É–ø—É—Ç–Ω–∏–∫–æ–º —É –Ω–∞–≤—á–∞–Ω–Ω—ñ.',
  '–î–µ—è–∫—ñ –∫–Ω–∏–∂–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –¥–æ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ–≥–æ –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è, —ñ–Ω—à—ñ ‚Äî –¥–ª—è –≥–ª–∏–±—à–æ–≥–æ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è –≤ —Ç–µ–º–∏, —è–∫—ñ –º–∏ —Ä–æ–∑–≥–ª—è–¥–∞—î–º–æ –Ω–∞ –∑–∞–Ω—è—Ç—Ç—è—Ö. –£—Å–µ, —â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ç—É—Ç, ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ, –æ—Å–º–∏—Å–ª–µ–Ω–æ —Ç–∞ —Å–ø—Ä–∞–≤–¥—ñ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –≤–∞—à–æ–≥–æ –æ—Å–æ–±–∏—Å—Ç–æ–≥–æ —à–ª—è—Ö—É.',
  '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–Ω–∞—Ö–æ–¥—å—Ç–µ —á–∞—Å –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è. –í–æ–Ω–æ –¥–æ–ø–æ–≤–Ω–∏—Ç—å —ñ –ø—ñ–¥—Å–∏–ª–∏—Ç—å —Ç–µ, —â–æ –º–∏ –ø—Ä–æ—Ö–æ–¥–∏–º–æ –Ω–∞ –∫—É—Ä—Å—ñ, –∞ —â–µ ‚Äî –ø–æ–¥–∞—Ä—É—î –Ω–æ–≤—ñ —Ä–æ–∑–¥—É–º–∏, –≤—ñ–¥—á—É—Ç—Ç—è —ñ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è üå±',
  '–°–ø–∏—Å–æ–∫ –º–æ–∂–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—è ‚Äî –∑–∞–≥–ª—è–¥–∞–π—Ç–µ —á–∞—Å –≤—ñ–¥ —á–∞—Å—É!',
];

const ConsultingHeader = ({ token, id }: ConsultingHeaderProps) => {
  const pathName = usePathname();
  const { data: course } = useSuspenseQuery({
    queryKey: ['course', id],
    queryFn: () => fetchCourseDetailsForUser(token, id),
    staleTime: 5 * 60 * 1000, // 5 minutes
  });
  const splitedPath = pathName.split('/');

  const courseType: courseType = course?.type === ADVANCED ? ADVANCED : CONSULTING;

  const getTitleAndText = () => {
    if (pathName?.includes('agreement')) {
      return { title: agreementTitle, text: agreementText };
    }
    if (pathName?.includes('literature')) {
      return { title: literalTitle, text: literalText };
    }
    return { title: defaultTitle, text: defaultText[courseType] };
  };

  const { title, text } = getTitleAndText();

  const showReturn = splitedPath[splitedPath.length - 2] === id;

  const link = splitedPath.slice(0, -1).join('/');

  return (
    <div className={styles.wrapper}>
      {id === splitedPath.pop() && <AgreementInfo isSign={course?.purchaseInfo?.agreement} />}
      {showReturn && (
        <Link href={link} className={styles.link_back}>
          <svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M13.7684 1.63982L9.29244 7.01082L13.6074 12.3728C13.9534 12.8028 13.8854 13.4318 13.4554 13.7788C13.2704 13.9278 13.0484 13.9998 12.8284 13.9998C12.5364 13.9998 12.2464 13.8718 12.0484 13.6268L7.22044 7.62682C6.92244 7.25582 6.92644 6.72482 7.23144 6.35982L12.2314 0.359821C12.5854 -0.0651786 13.2154 -0.121179 13.6404 0.231821C14.0644 0.584821 14.1214 1.21582 13.7684 1.63982ZM5.23204 0.359521C5.58504 -0.0644785 6.21504 -0.121479 6.64004 0.231521C7.06404 0.585521 7.12104 1.21552 6.76804 1.63952L2.29204 7.01052L6.60704 12.3725C6.95304 12.8025 6.88504 13.4325 6.45504 13.7785C6.27004 13.9275 6.04904 13.9995 5.82804 13.9995C5.53604 13.9995 5.24604 13.8725 5.04904 13.6265L0.22104 7.62652C-0.0779603 7.25552 -0.0729603 6.72552 0.23204 6.35952L5.23204 0.359521Z"
              fill="#CFB691"
            />
          </svg>
          –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –ø—Ä–æ–≥—Ä–∞–º–∏ –∫—É—Ä—Å—É
        </Link>
      )}
      <div className={styles.course_info_wrapper}>
        <AboutCourse course={course} />
        <Greeting title={title} text={text} />
      </div>
      <ToastContainer />
    </div>
  );
};

export default ConsultingHeader;
